function [timeSeries, specs] = makeTimeSeriesForFractalAnalysis(et_data_struct, varargin)

% temporarily hard-corded for debugging
et_data_struct = load('/Users/sifre002/Box/sifre002/18-Organized-Code/fractal-eye-analyses/data/JE000084_04_04/JE000084_04_04_calVerTimeSeries.mat');
%%
minTsLength = 1000;
for v=1:2:length(varargin)
    if strcmpi(varargin{v}, 'minLength')
        minTsLength = varargin{v+1};
    end
end
%% Pull d
try % fields have different names depening on whether calver trials
    tsdata = et_data_struct.segmentedData;
    col = et_data_struct.col;
catch ME
    if strcmpi(ME.identifier, 'MATLAB:nonExistentField')
        tsdata = et_data_struct.segmentedData_calVer;
        col = et_data_struct.calVerCol;
    else
        rethrow(ME)
    end
end

%% Remove empty cells from cell-array of time series
tsdata = tsdata(~cellfun(@isempty, tsdata));

%creates time-series based on longest fix, for each type
longestFix = cell2mat(et_timeseries(:, col.longestFixBool));
amp=cell2mat(et_timeseries(longestFix, col.amp));

%% Pull relevant variables
id=segment{1, col.id}; %ID
movie=segment{1,col.trial}; %movie name
if (size(segment,2) == 13) % dancing ladies trial - save segment number
    segNum = segment{1,13};
else
    segNum = 'NA';
end
longestFixDur = segment{1, col.longestFixDur};
propInterp = segment{1, col.propInterpolated};
propMissing = segment{1, col.propMissing};
specs = [id movie segNum longestFixDur propInterp propMissing];

%% Check if time series is long enough
warning=0;
if length(amp)<minTsLength
    fprintf("Warning: Time series too short");
    warning=1;
end
if warning==1
    return % leaves function if too short
end


end